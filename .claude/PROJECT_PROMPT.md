# Project: n8n-install

You are working on **n8n-install**, a Docker Compose-based infrastructure installer for n8n workflow automation and AI services.

## ðŸŽ¯ Project Context

**Type:** Docker infrastructure / Bash installer scripts
**Primary Language:** Bash, Docker Compose YAML, Caddyfile
**Purpose:** Self-hosted n8n + AI services with automated setup and HTTPS

**Key Features:**
- Profile-based service management (optional services via `COMPOSE_PROFILES`)
- Isolated networking (`n8nInstall_network`, all containers prefixed `n8nInstall_`)
- Reverse proxy pattern (Caddy handles all external HTTPS, no exposed service ports)
- Automated secret generation (passwords, keys, bcrypt hashes)
- Mission-critical deployment (uptime is essential, need rollback capabilities)

---

## ðŸ“š Documentation Structure

**Central Hub:** [docs/ai/INDEX.md](docs/ai/INDEX.md) - Start here for navigation

**Core Documentation:**
- [CODING-STANDARD.md](docs/ai/CODING-STANDARD.md) - Bash/Docker standards
- [TESTING-STANDARDS.md](docs/ai/TESTING-STANDARDS.md) - Manual validation procedures
- [SECURITY.md](docs/ai/SECURITY.md) - Secret handling, authentication
- [PLATFORM-ARCHITECTURE.md](docs/ai/PLATFORM-ARCHITECTURE.md) - Profile system, networking
- [INFRASTRUCTURE.md](docs/ai/INFRASTRUCTURE.md) - Docker Compose technical details
- [CONFIGURATION-MANAGEMENT.md](docs/ai/CONFIGURATION-MANAGEMENT.md) - .env variables, profiles
- [OBSERVABILITY.md](docs/ai/OBSERVABILITY.md) - Logging, monitoring, status reporting
- [ERROR-HANDLING.md](docs/ai/ERROR-HANDLING.md) - Failure modes, recovery
- [DEPLOYMENT.md](docs/ai/DEPLOYMENT.md) - Installation, updates, rollback
- [TROUBLESHOOTING.md](docs/ai/TROUBLESHOOTING.md) - Common issues and solutions
- [SERVICE-REGISTRY.md](docs/ai/SERVICE-REGISTRY.md) - Service catalog

---

## ðŸ”„ Agent Implementation Packets (AIPs)

**Framework:** [docs/AIP_FRAMEWORK.md](docs/AIP_FRAMEWORK.md)

**When to Create an AIP:**
- âœ… Fixing recurring issues (n8n password, database missing, Caddy/Cloudflare misalignment)
- âœ… Adding new services (pgAdmin, monitoring tools, etc.)
- âœ… Updating core scripts (install.sh, update.sh, etc.)
- âœ… Infrastructure changes (networking, security, profiles)

**Templates:**
- **Full AIP:** [docs/templates/AIP/](docs/templates/AIP/) - For complex changes (>2 hours, multi-service)
- **Lightweight AIP:** [docs/templates/aip-lite/](docs/templates/aip-lite/) - For quick fixes (<2 hours, single service)

**Feature Registry:** [docs/features/REGISTRY.yaml](docs/features/REGISTRY.yaml) - Update after completing AIPs

---

## ðŸ› ï¸ Common Workflows

### Fixing an Issue
1. Run `scripts/status_report.sh` to gather diagnostics
2. Create AIP using appropriate template (lite for quick fixes, full for complex changes)
3. Document root cause in AIP and [docs/ai/TROUBLESHOOTING.md](docs/ai/TROUBLESHOOTING.md)
4. Implement fix following [CODING-STANDARD.md](docs/ai/CODING-STANDARD.md)
5. Test using [TESTING-STANDARDS.md](docs/ai/TESTING-STANDARDS.md)
6. Update Feature Registry
7. Close AIP and archive learnings

### Adding a New Service
1. Review [docs/.cursor/rules/add-new-service.mdc](docs/.cursor/rules/add-new-service.mdc) (if exists) or follow pattern from existing services
2. Update files in this order:
   - `docker-compose.yml` - Add service with profile, no ports
   - `Caddyfile` - Add reverse proxy block
   - `.env.example` - Add hostname and credentials
   - `scripts/03_generate_secrets.sh` - Add to VARS_TO_GENERATE
   - `scripts/04_wizard.sh` - Add to service selection
   - `scripts/07_final_report.sh` - Add URL/credentials output
   - `docs/ai/SERVICE-REGISTRY.md` - Document service
3. Ask user if service needs Caddy basic auth protection
4. Create AIP to document the addition
5. Test clean install and update scenarios

---

## ðŸš¨ Critical Reminders

**Security:**
- Never hardcode secrets - use .env
- All admin interfaces get Caddy basic auth (unless explicitly user-approved exception)
- Secrets generated by `scripts/03_generate_secrets.sh` using `openssl` and Caddy bcrypt

**Architecture:**
- NO ports exposed except Caddy (80, 443)
- ALL containers use `n8nInstall_` prefix
- ALL services on `n8nInstall_network`
- Profile-based activation via `COMPOSE_PROFILES` in .env

**Reliability:**
- Always backup before changes: `scripts/backup_config.sh`
- Provide rollback procedures for all changes
- Updates must preserve user configurations
- Mission-critical: uptime is essential

**Testing:**
- Manual testing only (no automated tests yet)
- Use `scripts/status_report.sh` for diagnostics
- Use `scripts/validate_install.sh` after install/updates
- Test on clean VM before production

---

## ðŸ” Searching AIPs

**Before creating a new AIP**, search for related work:
```bash
# Search for similar issues
grep -r "keyword" docs/Agent\ Implementation\ Packets/

# Check Feature Registry for related features
cat docs/features/REGISTRY.yaml
```

---

## ðŸ“¦ Key Dependencies

**Service Dependencies:**
- n8n â†’ postgres (healthy), redis (healthy)
- n8n-worker â†’ postgres (healthy), redis (healthy)
- langfuse-web â†’ postgres (healthy), clickhouse (healthy), minio (started)
- grafana â†’ prometheus (started)

**See:** [docs/ai/INFRASTRUCTURE.md](docs/ai/INFRASTRUCTURE.md) for healthcheck details

---

## ðŸŽ“ Learning Resources

**For understanding this project:**
1. Read [docs/ai/PLATFORM-ARCHITECTURE.md](docs/ai/PLATFORM-ARCHITECTURE.md) first
2. Review [CLAUDE.md](CLAUDE.md) for project overview
3. Check [docs/ai/SERVICE-REGISTRY.md](docs/ai/SERVICE-REGISTRY.md) for service catalog

**For troubleshooting:**
1. [docs/ai/TROUBLESHOOTING.md](docs/ai/TROUBLESHOOTING.md) - Quick fixes
2. [docs/ai/ERROR-HANDLING.md](docs/ai/ERROR-HANDLING.md) - Recovery procedures
3. [docs/ai/OBSERVABILITY.md](docs/ai/OBSERVABILITY.md) - Diagnostics

---

## âœ… Pre-Commit Checklist

Before committing changes:
- [ ] Scripts have `set -euo pipefail`
- [ ] All variables quoted: `"${var}"`
- [ ] Containers have `n8nInstall_` prefix
- [ ] No ports exposed (except Caddy)
- [ ] Healthchecks defined for dependencies
- [ ] Secrets use standardized suffixes (_PASSWORD, _KEY, etc.)
- [ ] Changes documented in AIP
- [ ] .env.example updated if new vars added
- [ ] Manual testing completed (smoke tests minimum)

---

## ðŸ¤– Agent Behavior

**Proactive Actions:**
- Search existing AIPs before creating new ones
- Reference documentation by exact file paths
- Ask clarifying questions about auth requirements for new services
- Suggest backup before risky operations
- Document recovery procedures for all changes

**Communication Style:**
- Be concise (command line interface context)
- Use markdown formatting
- Provide exact file paths and line numbers
- Show diffs for configuration changes
- Explain WHY, not just WHAT

---

**Remember:** This is a mission-critical infrastructure project. Prioritize reliability, security, and recoverability over speed. When in doubt, backup first and ask the user.
